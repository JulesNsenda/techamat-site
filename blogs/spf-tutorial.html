<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Techamat - Sender Policy Framework</title>
    <link rel="stylesheet" href="../styles.css">
</head>

<body>
    <header id="header" role="banner"></header>
    <section id="content" aria-labelledby="content-title">
        <div class="container">
            <h1 class="section-title" id="content-title">Sender Policy Framework (SPF)</h1>
            <div class="content-date">March 31, 2025</div>
            <p>This tutorial aims to teach you all you need to know regarding Sender Policy Framework (SPF) with regards
                to its impact.</p>

            <h2>What is SPF?</h2>
            <p>SPF is a system that allows domain owners to specify which mail servers are allowed to send email from
                their domain. In other words, it determines which mail servers are permitted to send email where the
                "From" email address ends with that domain name.</p>
            <p>The purpose of SPF is to prevent others from pretending to be your organization. For example, if I own
                <code>example.com</code> and have two servers sending email for my domain—<code>1.2.3.4</code> and
                <code>5.6.7.8</code>—I want to tell all other mail servers to reject emails from
                <code>@example.com</code> unless they originate from those two IP addresses. SPF makes this possible.
            </p>
            <p>SPF is optional. Not all domains have it set up, and you don’t need SPF to send or receive email—the SMTP
                protocol functions without it. However, while SPF is theoretically optional, in practice, it’s critical.
                Some mail servers, like <code>gmail.com</code>, won’t accept email if SPF isn’t configured correctly.We
                need to understand SPF to ensure our customers’ settings are correct.</p>

            <h2>How Does SPF Work?</h2>
            <p>SPF works by adding a DNS record of type <code>TXT</code> for the domain you’re protecting. For
                <code>example.com</code>, you’d add a TXT record like this:
            </p>
            <pre><code>example.com. 300 IN TXT "v=spf1 ip4:1.2.3.4 ip4:5.6.7.8 -all"</code></pre>
            <p>This record states that only servers at <code>1.2.3.4</code> and <code>5.6.7.8</code> are authorized to
                send emails from addresses ending in <code>@example.com</code>. The <code>-all</code> means "reject all
                others." This can only be set by the domain’s DNS manager—we can’t do it for customers unless we host
                their DNS (which we don’t).</p>

            <h2>How Does SPF Impact Us?</h2>
            <p>When we send emails from our mail server on behalf of customers, SPF can cause issues if:</p>
            <ul>
                <li>We’re sending from the customer’s domain (e.g., <code>user@customer.co.za</code>),</li>
                <li>The receiving server checks SPF,</li>
                <li>The customer has SPF configured but hasn’t authorized our servers, or</li>
                <li>The customer lacks SPF, and the recipient (e.g., Gmail) rejects unauthenticated senders.</li>
            </ul>
            <p>If a customer’s SPF only authorizes their own servers (e.g., <code>12.34.56.78</code>), and we send from
                our servers, recipients checking SPF will reject the email.</p>

            <h2>How to Configure SPF for Our Customers</h2>
            <p>To send emails on behalf of customers (especially those using our hosted VP instances), follow these
                steps:</p>
            <h3>Check if the Customer Uses SPF</h3>
            <p>For a customer domain like <code>customer.co.za</code>, check for an SPF record on a Linux machine:</p>
            <pre><code>dig customer.co.za TXT</code></pre>
            <p>Look for output like:</p>
            <pre><code>customer.co.za. 300 IN TXT "v=spf1 ip4:12.34.56.78 -all"</code></pre>
            <p>Key indicators:</p>
            <ul>
                <li>The domain matches (<code>customer.co.za</code>),</li>
                <li>Type is <code>TXT</code>,</li>
                <li>Value starts with <code>v=spf1</code>.</li>
            </ul>
            <p>If no such line exists, they’re not using SPF.</p>

            <h3>If the Customer Isn’t Using SPF</h3>
            <p>If no SPF is set, encourage them to configure it. Without SPF, some servers (e.g., Gmail) may reject
                emails from their domain, impacting delivery to <code>@gmail.com</code> and other addresses.</p>

            <h3>If the Customer Is Using SPF</h3>
            <p>If they have SPF (e.g., <code>"v=spf1 ip4:12.34.56.78 -all"</code>), they need to include our servers as
                trusted senders. Instead of listing our IP addresses directly (which could change), they should include
                our SPF record:</p>
            <pre><code>customer.co.za. 300 IN TXT "v=spf1 ip4:12.34.56.78 include:spf.mail.techamat.co.za -all"</code></pre>
            <p>The <code>include:spf.mail.techamat.co.za</code> part authorizes any servers in our SPF record. If
                our server IPs change, we update <code>spf.mail.techamat.co.za</code>, and customers don’t need to
                adjust their records.</p>

            <h2>Not Every Rejection Is SPF-Related</h2>
            <p>When emails bounce, check the bounce message—don’t assume SPF is the culprit. It could be another issue,
                and focusing solely on SPF might waste time.</p>
        </div>
    </section>
    <footer role="contentinfo"></footer>
    <script src="../scripts.js"></script>
</body>

</html>